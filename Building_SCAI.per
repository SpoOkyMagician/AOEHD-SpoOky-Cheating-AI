; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; (Priority 5) - Building
; Description: Building your town from nothing to something.
; Note: I found it's best to organize this code by age. If you try to do things all it once, priority seems to get screwy... Things never get done the way you intent...
; Note: You may wonder why I don't build more than one building type until later. The reasoning behind this is the AI limitation. You cannot build more than one of each building type at a time.
; You also need to be careful to not get your AI stuck in a loop. If you tell your AI to build more than one type, it will get stuck in that section of code. It's better to build one of each type first.
; Once you have at least one of each, then you can build multiple buildings of whatever type you want. The only special case here is houses... More on this later...
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: DARK AGE
; Note: We need to build a Town Center first if we don't have one. This is VERY IMPORTANT. (especially, if we are playing nomad...)
; Note: Interesting fact, if you don't have certain buildings built, you cannot build other types. Keep this in mind.
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(building-type-count town-center <= 0)
	=>
	(build town-center)
)

(defrule
	(current-age == dark-age)
	(can-build mill)
	(building-type-count mill < 1)
	=>
	(build mill)
)

(defrule
	(current-age == dark-age)
	(can-build lumber-camp)
	(building-type-count lumber-camp < 1)
	=>
	(build lumber-camp)
)

(defrule
	(current-age == dark-age)
	(can-build mining-camp)
	(building-type-count mining-camp < 1)
	=>
	(build mining-camp)
)

(defrule
	(current-age == dark-age)
	(can-build barracks)
	(building-type-count barracks < 1)
	=>
	(build barracks)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: NOW we can have multiple buildings built.
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(current-age == dark-age)
	(can-build house)
	(building-type-count house < 100)
	(population-headroom >= 5)
	=>
	(build house)
)

(defrule
	(current-age == dark-age)
	(can-build barracks)
	(building-type-count barracks < 16)
	=>
	(build barracks)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: FEUDAL AGE
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(current-age == feudal-age)
	(can-build blacksmith)
	(building-type-count blacksmith < 1)
	=>
	(build blacksmith)
)

(defrule
	(current-age == feudal-age)
	(can-build market)
	(building-type-count market < 1)
	=>
	(build market)
)

(defrule
	(current-age == feudal-age)
	(can-build barracks)
	(building-type-count barracks < 1)
	=>
	(build barracks)
)

(defrule
	(current-age == feudal-age)
	(can-build archery-range)
	(building-type-count archery-range < 1)
	=>
	(build archery-range)
)

(defrule
	(current-age == feudal-age)
	(can-build stable)
	(building-type-count stable < 1)
	=>
	(build stable)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: NOW we can have multiple buildings built.
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(current-age == feudal-age)
	(can-build house)
	(building-type-count house < 100)
	(population-headroom >= 5)
	=>
	(build house)
)

(defrule
	(current-age == feudal-age)
	(can-build barracks)
	(building-type-count barracks < 16)
	=>
	(build barracks)
)

(defrule
	(current-age == feudal-age)
	(can-build archery-range)
	(building-type-count archery-range < 16)
	=>
	(build archery-range)
)

(defrule
	(current-age == feudal-age)
	(can-build stable)
	(building-type-count stable < 16)
	=>
	(build stable)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: CASTLE AGE
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(current-age == castle-age)
	(can-build university)
	(building-type-count university < 1)
	=>
	(build university)
)

(defrule
	(current-age == castle-age)
	(can-build monastery)
	(building-type-count monastery < 1)
	=>
	(build monastery)
)

(defrule
	(current-age == castle-age)
	(can-build castle)
	(building-type-count castle < 1)
	=>
	(build castle)
)

(defrule
	(current-age == castle-age)
	(can-build siege-workshop)
	(building-type-count siege-workshop < 1)
	=>
	(build siege-workshop)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: NOW we can have multiple buildings built.
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(current-age == castle-age)
	(can-build town-center)
	(building-type-count town-center >= 1)
	(building-type-count town-center < 3)
	=>
	(build town-center)
)

(defrule
	(current-age == feudal-age)
	(can-build house)
	(building-type-count house < 100)
	(population-headroom >= 5)
	=>
	(build house)
)

(defrule
	(current-age == castle-age)
	(can-build monastery)
	(building-type-count monastery < 16)
	=>
	(build monastery)
)

(defrule
	(current-age == castle-age)
	(can-build siege-workshop)
	(building-type-count siege-workshop < 16)
	=>
	(build siege-workshop)
)

(defrule
	(current-age == castle-age)
	(can-build castle)
	(building-type-count castle < 16)
	=>
	(build castle)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: IMPERIAL AGE
; Note: Even though we are in the last age, we still have to redo the rebuild loop again here. Keep things organized as much as possible. We can add multiple buildings after this.
; Note: Just in case they pick Post-Imperial, check current-age >= imperial-age or post-imperial stuff will not be triggered.
; Note: There is where the imperial/DM stuff comes in.
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#load-if-defined DEATH-MATCH

(defrule
	(can-build house)
	(current-age >= imperial-age)
	(building-type-count house < 100)
	(population-headroom >= 5)
	=>
	(build house)
)

(defrule
	(can-build barracks)
	(current-age >= imperial-age)
	(building-type-count barracks <= 0)
	=>
	(build barracks)
)

(defrule
	(can-build archery-range)
	(current-age >= imperial-age)
	(building-type-count archery-range <= 0)
	=>
	(build archery-range)
)

(defrule
	(can-build stable)
	(current-age >= imperial-age)
	(building-type-count stable <= 0)
	=>
	(build stable)
)

(defrule
	(can-build monastery)
	(current-age >= imperial-age)
	(building-type-count monastery <= 0)
	=>
	(build monastery)
)

(defrule
	(can-build siege-workshop)
	(current-age >= imperial-age)
	(building-type-count siege-workshop <= 0)
	=>
	(build siege-workshop)
)

(defrule
	(can-build castle)
	(current-age >= imperial-age)
	(building-type-count castle <= 0)
	=>
	(build castle)
)

#load-if-defined VICTORY-STANDARD
(defrule
	(can-build wonder)
	(building-type-count wonder < 1)
	=>
	(build wonder)
)
#end-if

(defrule
	(can-build town-center)
	(current-age >= imperial-age)
	(building-type-count town-center < 3)
	=>
	(build town-center)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: NOW we can have multiple buildings built.
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(can-build barracks)
	(current-age >= imperial-age)
	(building-type-count barracks < 16)
	=>
	(build barracks)
)

(defrule
	(can-build archery-range)
	(current-age >= imperial-age)
	(building-type-count archery-range < 16)
	=>
	(build archery-range)
)

(defrule
	(can-build stable)
	(current-age >= imperial-age)
	(building-type-count stable < 16)
	=>
	(build stable)
)

(defrule
	(can-build monastery)
	(current-age >= imperial-age)
	(building-type-count monastery < 16)
	=>
	(build monastery)
)

(defrule
	(can-build siege-workshop)
	(current-age >= imperial-age)
	(building-type-count siege-workshop < 16)
	=>
	(build siege-workshop)
)

(defrule
	(can-build castle)
	(current-age >= imperial-age)
	(building-type-count castle < 16)
	=>
	(build castle)
)

(defrule
	(can-build outpost)
	(current-age >= imperial-age)
	(building-type-count outpost < 4)
	=>
	(build outpost)
)

(defrule
	(can-build watch-tower-line)
	(current-age >= imperial-age)
	(building-type-count watch-tower-line < 4)
	=>
	(build watch-tower-line)
)

(defrule
	(can-build bombard-tower)
	(current-age >= imperial-age)
	(building-type-count bombard-tower < 4)
	=>
	(build bombard-tower)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: If town is fully built, build more towers! (We can defend wonders/monasteries this way.)
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(can-build watch-tower-line)
	(current-age >= imperial-age)
	(building-type-count mill >= 1)
	(building-type-count mining-camp >= 1)
	(building-type-count lumber-camp >= 1)
	(building-type-count town-center >= 1)
	(building-type-count barracks >= 1)
	(building-type-count archery-range >= 1)
	(building-type-count stable >= 1)
	(building-type-count market >= 1)
	(building-type-count blacksmith >= 1)
	(building-type-count castle >= 1)
	(building-type-count watch-tower-line < 50)
	=>
	(build watch-tower-line)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: Same for Bombard Towers!
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(can-build bombard-tower)
	(current-age >= imperial-age)
	(building-type-count mill >= 1)
	(building-type-count mining-camp >= 1)
	(building-type-count lumber-camp >= 1)
	(building-type-count town-center >= 1)
	(building-type-count barracks >= 1)
	(building-type-count archery-range >= 1)
	(building-type-count stable >= 1)
	(building-type-count market >= 1)
	(building-type-count blacksmith >= 1)
	(building-type-count castle >= 1)
	(building-type-count bombard-tower < 50)
	=>
	(build bombard-tower)
)

#else
(defrule
	(current-age >= imperial-age)
	(can-build mill)
	(building-type-count mill <= 0)
	=>
	(build mill)
)

(defrule
	(current-age >= imperial-age)
	(can-build lumber-camp)
	(building-type-count lumber-camp <= 0)
	=>
	(build lumber-camp)
)

(defrule
	(current-age >= imperial-age)
	(can-build mining-camp)
	(building-type-count mining-camp <= 0)
	=>
	(build mining-camp)
)

(defrule
	(can-build barracks)
	(current-age >= imperial-age)
	(building-type-count barracks <= 0)
	=>
	(build barracks)
)

(defrule
	(can-build archery-range)
	(current-age >= imperial-age)
	(building-type-count archery-range <= 0)
	=>
	(build archery-range)
)

(defrule
	(can-build stable)
	(current-age >= imperial-age)
	(building-type-count stable <= 0)
	=>
	(build stable)
)

(defrule
	(can-build blacksmith)
	(current-age >= imperial-age)
	(building-type-count blacksmith <= 0)
	=>
	(build blacksmith)
)

(defrule
	(can-build market)
	(current-age >= imperial-age)
	(building-type-count market <= 0)
	=>
	(build market)
)

(defrule
	(can-build university)
	(current-age >= imperial-age)
	(building-type-count university <= 0)
	=>
	(build university)
)

(defrule
	(can-build monastery)
	(current-age >= imperial-age)
	(building-type-count monastery <= 0)
	=>
	(build monastery)
)

(defrule
	(can-build siege-workshop)
	(current-age >= imperial-age)
	(building-type-count siege-workshop <= 0)
	=>
	(build siege-workshop)
)

(defrule
	(can-build castle)
	(current-age >= imperial-age)
	(building-type-count castle <= 0)
	=>
	(build castle)
)

#load-if-defined WONDER-RACE
(defrule
	(can-build wonder)
	(building-type-count wonder < 1)
	=>
	(build wonder)
)
#end-if

#load-if-defined VICTORY-STANDARD
(defrule
	(can-build wonder)
	(building-type-count wonder < 1)
	=>
	(build wonder)
)
#end-if

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: NOW we can have multiple buildings built.
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(can-build house)
	(current-age >= imperial-age)
	(building-type-count house < 100)
	(population-headroom >= 5)
	=>
	(build house)
)

(defrule
	(can-build town-center)
	(current-age >= imperial-age)
	(building-type-count town-center < 3)
	=>
	(build town-center)
)

(defrule
	(can-build barracks)
	(current-age >= imperial-age)
	(building-type-count barracks < 16)
	=>
	(build barracks)
)

(defrule
	(can-build archery-range)
	(current-age >= imperial-age)
	(building-type-count archery-range < 16)
	=>
	(build archery-range)
)

(defrule
	(can-build stable)
	(current-age >= imperial-age)
	(building-type-count stable < 16)
	=>
	(build stable)
)

(defrule
	(can-build monastery)
	(current-age >= imperial-age)
	(building-type-count monastery < 16)
	=>
	(build monastery)
)

(defrule
	(can-build siege-workshop)
	(current-age >= imperial-age)
	(building-type-count siege-workshop < 16)
	=>
	(build siege-workshop)
)

(defrule
	(can-build castle)
	(current-age >= imperial-age)
	(building-type-count castle < 16)
	=>
	(build castle)
)

(defrule
	(can-build outpost)
	(current-age >= imperial-age)
	(building-type-count outpost < 4)
	=>
	(build outpost)
)

(defrule
	(can-build watch-tower-line)
	(current-age >= imperial-age)
	(building-type-count watch-tower-line < 4)
	=>
	(build watch-tower-line)
)

(defrule
	(can-build bombard-tower)
	(current-age >= imperial-age)
	(building-type-count bombard-tower < 4)
	=>
	(build bombard-tower)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: If town is fully built, build more towers! (We can defend wonders/monasteries this way.)
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(can-build watch-tower-line)
	(current-age >= imperial-age)
	(building-type-count mill >= 1)
	(building-type-count mining-camp >= 1)
	(building-type-count lumber-camp >= 1)
	(building-type-count town-center >= 1)
	(building-type-count barracks >= 1)
	(building-type-count archery-range >= 1)
	(building-type-count stable >= 1)
	(building-type-count market >= 1)
	(building-type-count blacksmith >= 1)
	(building-type-count castle >= 1)
	(building-type-count watch-tower-line < 50)
	=>
	(build watch-tower-line)
)

; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
; Note: Same for Bombard Towers!
; ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

(defrule
	(can-build bombard-tower)
	(current-age >= imperial-age)
	(building-type-count mill >= 1)
	(building-type-count mining-camp >= 1)
	(building-type-count lumber-camp >= 1)
	(building-type-count town-center >= 1)
	(building-type-count barracks >= 1)
	(building-type-count archery-range >= 1)
	(building-type-count stable >= 1)
	(building-type-count market >= 1)
	(building-type-count blacksmith >= 1)
	(building-type-count castle >= 1)
	(building-type-count bombard-tower < 50)
	=>
	(build bombard-tower)
)
#end-if